<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>HellPulse Visuals</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.min.js"></script>
    <link rel="stylesheet" href="style.css?v=2" />
    <link rel="icon" type="image/png" href="HellPulse.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
  </head>
  <body>
    <main id="main-area">
      <div id="demon-frame">
        <div id="frame-border">
          <div id="frame-inner">
            <div id="canvas-container">
              <!-- La canvas viene creata da p5.js qui dentro -->
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer id="gui-bar">
      <div id="track-title">HellPulse Visual Generator</div>
      <div id="controls-row">
        <!-- Controlli principali sempre visibili -->
        <div class="control-group">
          <button id="play-pause-btn" class="control-btn primary">
            <i class="fas fa-play"></i> <span>Play</span>
          </button>
        </div>
        
        <div class="control-group">
          <select id="background-select" class="control-select">
            <option value="none">ğŸ–¼ï¸ Nessuno</option>
            <option value="bg1.gif">ğŸ–¼ï¸ BG 1</option>
            <option value="bg2.gif">ğŸ–¼ï¸ BG 2</option>
            <option value="bg3.gif">ğŸ–¼ï¸ BG 3</option>
            <option value="custom">ğŸ“ Custom...</option>
          </select>
          <input id="background-upload-input" type="file" accept="image/*" style="display:none;" />
        </div>
        
        <div class="control-group">
          <select id="subject-select" class="control-select">
            <option value="gengar.png">ğŸ¨ Gengar</option>
            <option value="tribalHeart.png">ğŸ¨ TribalHeart</option>
            <option value="HellPulse.png">ğŸ¨ HellPulse</option>
            <option value="custom">ğŸ“ Custom...</option>
          </select>
          <input id="subject-upload-input" type="file" accept="image/*" style="display:none;" />
        </div>
        
        <!-- Toggle compatti -->
        <div class="control-group">
          <label class="toggle-label">
            <input type="checkbox" id="sync-toggle" />
            <span class="toggle-text"><i class="fas fa-sync-alt"></i> Sync</span>
            <span id="bpm-readout" class="bpm-badge">-- BPM</span>
          </label>
        </div>
        
        <div class="control-group">
          <label class="toggle-label">
            <input type="checkbox" id="effects-toggle" checked />
            <span class="toggle-text"><i class="fas fa-star"></i> Effects</span>
          </label>
        </div>
        
        <!-- Tendine collapsibili per slider -->
        <div class="control-group collapsible">
          <button class="collapsible-btn" data-target="volume-panel">
            <i class="fas fa-volume-up"></i> Volume <i class="fas fa-chevron-down"></i>
          </button>
          <div class="collapsible-content" id="volume-panel">
            <label style="display:block;margin-bottom:8px;color:#ddd;font-size:0.9em;">Volume</label>
            <input id="volume-slider" type="range" min="0" max="1" step="0.01" value="0.5" style="width:100%;margin-bottom:12px;" />
            <label class="toggle-label compact">
              <input type="checkbox" id="mute-toggle" />
              <span class="toggle-text"><i class="fas fa-volume-mute"></i> Mute</span>
            </label>
          </div>
        </div>
        
        <div class="control-group collapsible">
          <button class="collapsible-btn" data-target="track-panel">
            <i class="fas fa-music"></i> Track <i class="fas fa-chevron-down"></i>
          </button>
          <div class="collapsible-content" id="track-panel">
            <label style="display:block;margin-bottom:8px;color:#ddd;font-size:0.9em;">Seleziona Track</label>
            <select id="track-select" class="control-select" style="width:100%;margin-bottom:12px;">
              <option value="default">ğŸµ Default</option>
              <option value="custom">ğŸ“ Custom...</option>
            </select>
            <label style="display:block;margin-bottom:8px;margin-top:16px;color:#ddd;font-size:0.9em;">Posizione</label>
            <input id="seek-slider" type="range" min="0" max="1" step="0.001" value="0" style="width:100%;" />
            <input id="audio-upload-input" type="file" accept="audio/*" style="display:none;" />
          </div>
        </div>
        
        <div class="control-group collapsible">
          <button class="collapsible-btn" data-target="glitch-panel">
            <i class="fas fa-bolt"></i> Glitch <i class="fas fa-chevron-down"></i>
          </button>
          <div class="collapsible-content" id="glitch-panel">
            <label style="display:block;margin-bottom:8px;color:#ddd;font-size:0.9em;">IntensitÃ  Glitch</label>
            <input id="glitch-slider" class="colorful-glitch" type="range" min="0" max="1" step="0.01" value="0" style="width:100%;" />
          </div>
        </div>
      </div>
    </footer>
    <section id="info-section">
      <div class="info-card">
        <div class="info-content">
          <div class="info-title">HellPulse Visuals</div>
          <div class="info-desc">
            Realizzato da <a href="https://instagram.com/eugeniobellini" target="_blank" rel="noopener" class="insta-link">@eugeniobellini</a>. 
            Segui <a href="https://instagram.com/benzodiazepics" target="_blank" rel="noopener" class="insta-link">benzodiazepics</a>. 
            <a href="https://github.com/pastapomodoro/HellPulse-Visuals" target="_blank" rel="noopener" class="github-link">GitHub</a>.
            Supportami su <a href="https://ko-fi.com/ugiex" target="_blank" rel="noopener" class="kofi-link-compact">Ko-fi</a>.
          </div>
        </div>
      </div>
    </section>
    <script src="sketch.js?v=2"></script>
    <script>
      // Assicurati che il DOM sia caricato
      document.addEventListener('DOMContentLoaded', function() {
        
      // Gestione tendine collapsibili
      document.querySelectorAll('.collapsible-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const targetId = this.getAttribute('data-target');
          const panel = document.getElementById(targetId);
          const icon = this.querySelector('.fa-chevron-down');
          
          if (panel.style.display === 'block') {
            panel.style.display = 'none';
            icon.classList.remove('fa-chevron-up');
            icon.classList.add('fa-chevron-down');
          } else {
            // Chiudi tutte le altre tendine
            document.querySelectorAll('.collapsible-content').forEach(p => {
              p.style.display = 'none';
            });
            document.querySelectorAll('.collapsible-btn .fa-chevron-up').forEach(i => {
              i.classList.remove('fa-chevron-up');
              i.classList.add('fa-chevron-down');
            });
            
            // Apri quella cliccata
            panel.style.display = 'block';
            icon.classList.remove('fa-chevron-down');
            icon.classList.add('fa-chevron-up');
          }
        });
      });
      
      // Gestione Custom per Background
      const backgroundSelect = document.getElementById('background-select');
      const backgroundUploadInput = document.getElementById('background-upload-input');
      if (backgroundSelect && backgroundUploadInput) {
        backgroundSelect.addEventListener('change', function(e) {
          e.stopPropagation();
          if (this.value === 'custom') {
            setTimeout(() => {
              backgroundUploadInput.click();
            }, 10);
          }
        });
        backgroundUploadInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file && backgroundSelect) {
            // Il caricamento sarÃ  gestito da sketch.js
            // Qui solo aggiorniamo il select per mostrare che Ã¨ stato caricato
            const option = backgroundSelect.querySelector('option[value="custom"]');
            if (option) {
              const shortName = file.name.length > 20 ? file.name.substring(0, 17) + '...' : file.name;
              option.textContent = 'ğŸ“ Custom: ' + shortName;
            }
            // Assicurati che il select rimanga su "custom"
            backgroundSelect.value = 'custom';
          } else {
            // Se non c'Ã¨ file, ripristina il select
            if (backgroundSelect.value === 'custom') {
              backgroundSelect.value = 'none';
            }
          }
        });
      }
      
      // Gestione Custom per Subject
      const subjectSelect = document.getElementById('subject-select');
      const subjectUploadInput = document.getElementById('subject-upload-input');
      if (subjectSelect && subjectUploadInput) {
        subjectSelect.addEventListener('change', function(e) {
          e.stopPropagation();
          if (this.value === 'custom') {
            setTimeout(() => {
              subjectUploadInput.click();
            }, 10);
          }
        });
        subjectUploadInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file && subjectSelect) {
            // Il caricamento sarÃ  gestito da sketch.js
            // Qui solo aggiorniamo il select per mostrare che Ã¨ stato caricato
            const option = subjectSelect.querySelector('option[value="custom"]');
            if (option) {
              const shortName = file.name.length > 20 ? file.name.substring(0, 17) + '...' : file.name;
              option.textContent = 'ğŸ“ Custom: ' + shortName;
            }
            // Assicurati che il select rimanga su "custom"
            subjectSelect.value = 'custom';
          } else {
            // Se non c'Ã¨ file, ripristina il select
            if (subjectSelect.value === 'custom') {
              subjectSelect.value = 'gengar.png';
            }
          }
        });
      }
      
      // Gestione Custom per Track
      const trackSelect = document.getElementById('track-select');
      const audioUploadInput = document.getElementById('audio-upload-input');
      if (trackSelect && audioUploadInput) {
        trackSelect.addEventListener('change', function(e) {
          e.stopPropagation();
          if (this.value === 'custom') {
            setTimeout(() => {
              audioUploadInput.click();
            }, 10);
          }
        });
        audioUploadInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file && trackSelect) {
            // Il caricamento sarÃ  gestito da sketch.js
            // Qui solo aggiorniamo il select per mostrare che Ã¨ stato caricato
            const option = trackSelect.querySelector('option[value="custom"]');
            if (option) {
              const shortName = file.name.length > 20 ? file.name.substring(0, 17) + '...' : file.name;
              option.textContent = 'ğŸ“ Custom: ' + shortName;
            }
            // Assicurati che il select rimanga su "custom"
            trackSelect.value = 'custom';
          } else {
            // Se non c'Ã¨ file, ripristina il select
            if (trackSelect.value === 'custom') {
              trackSelect.value = 'default';
            }
          }
        });
      }
      
      // Aggiorna icona play/pause
      const playPauseBtn = document.getElementById('play-pause-btn');
      if (playPauseBtn) {
        const icon = playPauseBtn.querySelector('i');
        const text = playPauseBtn.querySelector('span');
        // Questo sarÃ  aggiornato dinamicamente da sketch.js
        const observer = new MutationObserver(() => {
          const isPlaying = text.textContent === 'Pause';
          icon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
        });
        observer.observe(text, { childList: true, characterData: true, subtree: true });
      }
      
      });
    </script>
  </body>
</html> 